# direnv configuration for automatic environment setup
# Install direnv: https://direnv.net/docs/installation.html
# Usage: direnv allow (after editing this file)

# Load environment from .env if it exists
if [ -f .env ]; then
    source .env
fi

# Add Bazel output to PATH (for easy access to built binaries)
PATH_add "$(pwd)/bazel-bin"

# Add tools provided by bazel_env (if available)
BAZEL_ENV_BIN_LOCAL="$(pwd)/bazel-bin/tools/bazel_env/bin"
if [ -d "${BAZEL_ENV_BIN_LOCAL}" ]; then
    watch_file "${BAZEL_ENV_BIN_LOCAL}"
    PATH_add "${BAZEL_ENV_BIN_LOCAL}"
elif command -v bazel >/dev/null 2>&1; then
    BAZEL_BIN="$(bazel info bazel-bin 2>/dev/null || true)"
    if [ -n "${BAZEL_BIN}" ]; then
        BAZEL_ENV_BIN="${BAZEL_BIN}/tools/bazel_env/bin"
        watch_file "${BAZEL_ENV_BIN}"
        if [ -d "${BAZEL_ENV_BIN}" ]; then
            PATH_add "${BAZEL_ENV_BIN}"
        else
            log_status "bazel_env not built yet; run 'bazel run //tools:bazel_env'"
        fi
    fi
fi

# Optional: Set Bazel flags for this workspace
# export BAZELFLAGS="--config=debug"

# Show direnv status
echo "âœ“ C Template environment loaded (direnv)"
